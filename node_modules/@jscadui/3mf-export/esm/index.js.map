{
  "version": 3,
  "sources": ["../src/defMatrix.js", "../src/matrix2str.js", "../src/makeItem.js", "../src/toDate3mf.js", "../src/pushHeader.js", "../src/pushObjectComponent.js", "../src/pushObjectMesh.js", "../src/staticFiles.js", "../index.js"],
  "sourcesContent": ["/* prettier-ignore */\r\nexport const defMatrix = [\r\n    1, 0, 0, 0,\r\n    0, 1, 0, 0,\r\n    0, 0, 1, 0,\r\n    0, 0, 0, 1\r\n  ]\r\n", "\r\n/** transform for attribute as specifiend in 3mf format\r\n * \r\n * When objects need to be transformed for rotation, scaling, or translation purposes, \r\n * row-major affine 3D matrices (4x4) are used. The matrix SHOULD NOT be singular or nearly singular.\r\n * Transforms are of the form, where only the first 3 column values are specified. \r\n * The last column is never provided, and has the fixed values 0.0, 0.0, 0.0, 1.0. \r\n * When specified as an attribute value, \r\n * matrices have the form \"m00 m01 m02 m10 m11 m12 m20 m21 m22 m30 m31 m32\" \r\n * where each value is a decimal number of arbitrary precision.\r\n * \r\n * @param {mat4} matrix\r\n * @return string tarnsform attribute value\r\n*/\r\nexport const matrix2str = m=>{\r\n    let str = ''\r\n    for(let i=0; i<16; i++){\r\n        if(i % 4 == 3) continue\r\n        if(i>0) str += ' '\r\n        str += m[i] || 0\r\n    }\r\n    return str\r\n}", "import { defMatrix } from './defMatrix.js'\r\nimport { matrix2str } from './matrix2str.js'\r\n/**\r\n * \r\n * @param {string} id - must start with 1, can not be zero by spec\r\n * @param {mat4} matrix \r\n * @returns \r\n */\r\nexport const makeItem = (id = 1, matrix = defMatrix) =>\r\n  `    <item objectid=\"${id}\" transform=\"${matrix2str(matrix)}\" />\\n`\r\n", "export const toDate3mf = d => (d ? d.toISOString().substring(0, 10) : '')\r\n", "import { toDate3mf } from './toDate3mf.js'\r\n\r\n/**\r\n * @typedef Header\r\n * @prop {'micron'|'millimeter'|'centimeter'|'inch'|'foot'|'meter'} unit\r\n * @prop {string} [title]\r\n * @prop {string} [author]\r\n * @prop {string} [description]\r\n * @prop {string} [application]\r\n * @prop {string} [creationDate]\r\n * @prop {string} [license]\r\n * @prop {string} [modificationDate] \r\n * \r\n * \r\n * @param {Array<string>} out \r\n * @param {Header} param1 \r\n */\r\nexport function pushHeader(out,{\r\n  unit = 'millimeter',\r\n  title = 'jscad model',\r\n  author = '',\r\n  description = '',\r\n  application = 'jscad',\r\n  creationDate = new Date(),\r\n  license = '',\r\n  modificationDate,\r\n}={}) {\r\n  out.push(\r\n    `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<model unit=\"${unit}\" xml:lang=\"en-US\" xmlns=\"http://schemas.microsoft.com/3dmanufacturing/core/2015/02\" xmlns:slic3rpe=\"http://schemas.slic3r.org/3mf/2017/06\">\r\n  <metadata name=\"slic3rpe:Version3mf\">1</metadata>\r\n  <metadata name=\"Title\">${title}</metadata>\r\n  <metadata name=\"Designer\">${author}</metadata>\r\n  <metadata name=\"Description\">${description || title}</metadata>\r\n  <metadata name=\"Copyright\"></metadata>\r\n  <metadata name=\"LicenseTerms\">${license}</metadata>\r\n  <metadata name=\"Rating\"></metadata>\r\n  <metadata name=\"CreationDate\">${toDate3mf(creationDate)}</metadata>\r\n  <metadata name=\"ModificationDate\">${toDate3mf(modificationDate || creationDate)}</metadata>\r\n  <metadata name=\"Application\">${application}</metadata>\r\n   `,\r\n  )\r\n}\r\n", "import {defMatrix} from './defMatrix.js'\r\nimport {matrix2str} from './matrix2str.js'\r\n\r\n/**\r\n * \r\n * @param {Array<String>} out \r\n * @param {string} id \r\n * @param {Array<import('../index.js').Component3MF>} children \r\n * @param {string} name \r\n */\r\nexport function pushObjectWithComponents(out, id, children, name) {\r\n  out.push(`<object id=\"${id}\" type=\"model\"${\r\n      name == null ? '' : ' name=\"' + name + '\"'}>\\n`)\r\n  out.push(` <components>\\n`)\r\n  children.forEach(\r\n      ({objectID, transform}) => {addComp(out, objectID, transform)})\r\n  out.push(` </components>\\n`)\r\n  out.push(`</object>\\n`)\r\n}\r\n\r\n/**\r\n * \r\n * @param {*} out \r\n * @param {*} id - must start with 1, can not be zero by spec \r\n * @param {*} matrix \r\n */\r\nconst addComp = (out, id = 1, matrix = defMatrix) => {\r\n  out.push(\r\n      `    <component objectid=\"${id}\" transform=\"${matrix2str(matrix)}\" />\\n`)\r\n}\r\n", "/**\r\n *\r\n * @param {Arrray<string>} out\r\n * @param {string} id\r\n * @param {Float32Array} vertices\r\n * @param {Uint32Array} indices\r\n * @param {number} precision\r\n * @param {string} [name]\r\n * @returns\r\n */\r\nexport function pushObjectWithMesh(\r\n    out, id, vertices, indices, precision, name) {\r\n  out.push(`  <object id=\"${id}\" type=\"model\"${\r\n      !name ? '' : ' name=\"' + name + '\"'}>\r\n   <mesh>\r\n    <vertices>\r\n`)\r\n\r\n  for (let i = 0; i < vertices.length; i += 3) {\r\n    out.push(`     <vertex x=\"${vertices[i].toPrecision(precision)}\" y=\"${\r\n        vertices[i + 1].toPrecision(\r\n            precision)}\" z=\"${vertices[i + 2].toPrecision(precision)}\" />\\n`)\r\n  }\r\n\r\n  out.push(`    </vertices>\r\n    <triangles>\r\n`)\r\n\r\n  for (let i = 0; i < indices.length; i += 3) {\r\n    out.push(`     <triangle v1=\"${indices[i]}\" v2=\"${indices[i + 1]}\" v3=\"${\r\n        indices[i + 2]}\" />\\n`)\r\n  }\r\n\r\n\r\n  out.push(`    </triangles>\r\n   </mesh>\r\n  </object>\r\n`)\r\n\r\n  return out\r\n}", "\r\n/** File that describes content types inside a 3mf  */\r\nexport const fileForContentTypes = {\r\n  name:'[Content_Types].xml',\r\n  content: `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<Types xmlns=\"http://schemas.openxmlformats.org/package/2006/content-types\">\r\n<Default Extension=\"rels\" ContentType=\"application/vnd.openxmlformats-package.relationships+xml\" />\r\n<Default Extension=\"model\" ContentType=\"application/vnd.ms-package.3dmanufacturing-3dmodel+xml\" />\r\n<Default Extension=\"png\" ContentType=\"image/png\" />\r\n</Types>`\r\n}\r\n\r\n", "// this implementation exports to 3mf by filling array of strings and doing join\r\n// at the encoding tests for large files have shown significant speedup related\r\n// to using string concatenation\r\nimport { makeItem } from './src/makeItem.js'\r\nimport { pushHeader } from './src/pushHeader.js'\r\nimport { pushObjectWithComponents } from './src/pushObjectComponent.js'\r\nimport { pushObjectWithMesh } from './src/pushObjectMesh.js'\r\n\r\nexport * from './src/staticFiles.js'\r\n\r\n/**\r\n * @typedef Mesh3MF\r\n * @prop {string} id\r\n * @prop {Float32Array} vertices\r\n * @prop {Uint32Array} indices\r\n * @prop {string} [name]\r\n *\r\n * @typedef Mesh3MFSimpleExt\r\n * @prop {mat4} transform\r\n *\r\n * @typedef {Mesh3MF & Mesh3MFSimpleExt} Mesh3MFSimple\r\n *\r\n * @typedef Component3MF\r\n * @prop {string} id\r\n * @prop {string} name\r\n * @prop {Array<Child3MF>} children\r\n *\r\n * @typedef Child3MF\r\n * @prop {string} objectID\r\n * @prop {mat4} transform\r\n *\r\n * @typedef To3MF\r\n * @prop {Array<Mesh3MF>} meshes - manually declare meshes\r\n * @prop {Array<Component3MF>} [components] - components can combine items\r\n * @prop {Array<Child3MF>} items - output items, each pointing to component or mesh with objectID\r\n * @prop {number} precision\r\n * @prop {import('./src/pushHeader.js').Header} header\r\n */\r\n\r\n/**\r\n * @param {To3MF} options\r\n * @returns string\r\n */\r\nexport function to3dmodel({ meshes = [], components = [], items = [], precision = 17, header }) {\r\n  // items to be placed on the scene (build section of 3mf)\r\n  const out = []\r\n\r\n  // <model> tag is opened here\r\n  pushHeader(out, header)\r\n\r\n  // #region resources\r\n  out.push('  <resources>\\n')\r\n\r\n  if (items.length == 0) {\r\n    console.error('3MF empty build! Include items or simple.')\r\n  }\r\n\r\n  meshes.forEach(({ id, vertices, indices, name }) => pushObjectWithMesh(out, id, vertices, indices, precision, name))\r\n\r\n  components.forEach(({ id, children, name }) => {\r\n    pushObjectWithComponents(out, id, children, name)\r\n  })\r\n\r\n  out.push('  </resources>\\n')\r\n  // #endregion\r\n\r\n  out.push(`<build>\\n`)\r\n  items.forEach(({ objectID, transform }) => {\r\n    out.push(makeItem(objectID, transform))\r\n  })\r\n  out.push('</build>\\n')\r\n\r\n  out.push('</model>\\n') // model tag was opened in the pushHeader()\r\n\r\n  return out.join('')\r\n}\r\n\r\n/** Simple export provided meshes that have transform attached to them and autocreate items and pass to to3dmodel.\r\n *\r\n * @param {Array<Mesh3MFSimple>} meshes\r\n * @param {import('./src/pushHeader.js').Header} header\r\n * @param {number} precision\r\n * @returns string\r\n */\r\nexport function to3dmodelSimple(meshes, header, precision) {\r\n  const items = []\r\n  meshes.forEach(({ id, transform }) => {\r\n    items.push({ objectID: id, transform })\r\n  })\r\n  return to3dmodel({ meshes, items, header, precision })\r\n}\r\n\r\n/** File that describes file relationships inside a 3mf  */\r\nexport class FileForRelThumbnail {\r\n  constructor() {\r\n    this.idSeq = 0\r\n    this.lines = [\r\n      `<?xml version=\"1.0\" encoding=\"UTF-8\"?>`,\r\n      `<Relationships xmlns=\"http://schemas.openxmlformats.org/package/2006/relationships\">`,\r\n    ]\r\n  }\r\n  get name() {\r\n    return '_rels/.rels'\r\n  }\r\n    /**\r\n   *\r\n   * @param {*} target file path\r\n   * @param {*} xmlType xml schema url\r\n   */\r\n  addRel(target, xmlType) {\r\n    this.lines.push(`  <Relationship Target=\"${target}\" Id=\"rel-${++this.idSeq}\" Type=\"${xmlType}\" />`)\r\n  }\r\n  add3dModel(path) {\r\n    this.addRel(path, 'http://schemas.microsoft.com/3dmanufacturing/2013/01/3dmodel')\r\n  }\r\n  addThumbnail(path) {\r\n    this.addRel(path, 'http://schemas.openxmlformats.org/package/2006/relationships/metadata/thumbnail')\r\n  }\r\n\r\n  get content() {\r\n    return this.lines.join('\\n') + `\\n</Relationships>`\r\n  }\r\n}\r\n"],
  "mappings": "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",
  "names": ["defMatrix", "matrix2str", "m", "str", "i", "makeItem", "id", "matrix", "defMatrix", "matrix2str", "toDate3mf", "d", "pushHeader", "out", "unit", "title", "author", "description", "application", "creationDate", "license", "modificationDate", "toDate3mf", "pushObjectWithComponents", "out", "id", "children", "name", "objectID", "transform", "addComp", "matrix", "defMatrix", "matrix2str", "pushObjectWithMesh", "out", "id", "vertices", "indices", "precision", "name", "i", "fileForContentTypes", "to3dmodel", "meshes", "components", "items", "precision", "header", "out", "pushHeader", "id", "vertices", "indices", "name", "pushObjectWithMesh", "children", "pushObjectWithComponents", "objectID", "transform", "makeItem", "to3dmodelSimple", "FileForRelThumbnail", "target", "xmlType", "path"]
}
