import esbuild from 'esbuild';
import pipe from 'esbuild-plugin-pipe';
import textReplace from '../dist/index.esm.mjs'

await esbuild
    .build({
        entryPoints: ['src/index.mjs'],
        bundle: true,
        outfile: 'main.js',
        plugins: [
            pipe({
                filter: /.*/,
                namespace: '',
                plugins: [
                    textReplace(
                        {
                            include: /\/a.mjs$/,
                            pattern:[
                                ['const installRetry','let installRetry'],
                                [/const\s+{\s*textReplace\s*}\s*=\s*require\s*\(\s*'esbuild-plugin-text-replace'\s*\)\s*;/g , "'import textReplace from 'esbuild-plugin-text-replace'"]
                            ]
                        }
                    )
                ]
            })
        ]
    })